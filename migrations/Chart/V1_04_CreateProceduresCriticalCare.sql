-- Creation script for ChartsSourceOfTruth additions for the Procedures CriticalCare section options
DO $$
DECLARE
    chart_code TEXT;
    elem RECORD;
BEGIN
    -- Outer loop: for each chart code
    FOR chart_code IN
        SELECT * FROM (VALUES
            ('T001x'),('T002x'),('T003x'),
            ('T006x'),('T007x'),('T008x'),
            ('T009x'),('T010x'),('T011x'),
            ('T012x'),('T013x'),('T015x'),
            ('T024x'),('T025x'),('T028x'),
            ('T029x'),('T030x'),('T031x'),
            ('T032x'),('T033x'),('T035x'),
            ('T036x'),('T039x'),('T040x'),
            ('T042x'),('T051x'),('T057x'),
            ('T058x'),('T070a')
        ) AS t(chart_code)
    LOOP
        FOR elem IN
            SELECT 
                answer_code::TEXT, 
                type::TEXT, 
                label::TEXT
            FROM (
                VALUES
                    ('Q002', 'subsection-title', ''),
                    ('criticalCareSwitch', 'switch', ''),
                    ('Q002A001', 'date', ''),
                    ('Q002A002', 'date', ''),
                    ('Q002A003', 'option', 'verified w/'),
                    ('Q002A004', 'option', 'MD'),
                    ('Q002A005', 'option', 'RN'),
                    ('Q002A006', 'input', ''),
                    ('Q002A007', 'date', ''),
                    ('Q002A008', 'option', '1. Patient ID verified with'),
                    ('Q002A009', 'option', 'identifiers'),
                    ('Q002A010', 'input', ''),
                    ('Q002A011', 'date', ''),
                    ('Q002A012', 'option', '2. Correct Procedure, Equipment, and Position Verified'),
                    ('Q002A013', 'input', ''),
                    ('Q002A014', 'date', ''),
                    ('Q002A015', 'option', '3. Correct Site Verified and Marked'),
                    ('Q002A016', 'input', ''),
                    ('Q002A017', 'date', ''),
                    ('Q002A018', 'option', 'assisted w/'),
                    ('Q002A019', 'option', 'intubation'),
                    ('Q002A020', 'option', 'ETT #'),
                    ('Q002A021', 'input', ''),
                    ('Q002A022', 'date', ''),
                    ('Q002A023', 'option', 'placement verified by:'),
                    ('Q002A024', 'option', 'CXR'),
                    ('Q002A025', 'option', 'ausculation'),
                    ('Q002A026', 'input', ''),
                    ('Q002A028', 'date', ''),
                    ('Q002A029', 'option', 'ventilator'),
                    ('Q002A030', 'option', 'TV'),
                    ('Q002A031', 'input', ''),
                    ('Q002A032', 'option', 'rate'),
                    ('Q002A033', 'input', ''),
                    ('Q002A034', 'option', 'FiO2'),
                    ('Q002A035', 'input', ''),
                    ('Q002A036', 'input', ''),
                    ('Q002A037', 'date', ''),
                    ('Q002A038', 'option', 'cardioversion'),
                    ('Q002A039', 'input', ''),
                    ('Q002A040', 'date', ''),
                    ('Q002A041', 'option', 'CPR'),
                    ('Q002A042', 'option', 'see flow sheet'),
                    ('Q002A043', 'input', ''),
                    ('Q002A044', 'date', ''),
                    ('Q002A045', 'option', 'Foley'),
                    ('Q002A046', 'input', ''),
                    ('Q002A047', 'option', 'fr.'),
                    ('Q002A048', 'input', ''),
                    ('Q002A049', 'option', 'mL return.'),
                    ('Q002A050', 'input', ''),
                    ('Q002A051', 'date', ''),
                    ('Q002A052', 'option', 'reason'),
                    ('Q002A053', 'input', ''),
                    ('Q002A054', 'date', ''),
                    ('Q002A055', 'option', 'prep'),
                    ('Q002A056', 'option', 'hand hygiene'),
                    ('Q002A057', 'option', 'sterile equipment'),
                    ('Q002A058', 'option', 'aseptic technique'),
                    ('Q002A059', 'input', ''),
                    ('Q002A060', 'date', ''),
                    ('Q002A061', 'option', 'attached to'),
                    ('Q002A062', 'option', 'bedside bag below bladder'),
                    ('Q002A063', 'option', 'urimeter'),
                    ('Q002A064', 'option', 'leg bag'),
                    ('Q002A065', 'input', ''),
                    ('Q002A066', 'date', ''),
                    ('Q002A067', 'option', 'secured'),
                    ('Q002A068', 'option', 'tape'),
                    ('Q002A069', 'option', 'velcro'),
                    ('Q002A070', 'option', 'strap'),
                    ('Q002A071', 'input', ''),
                    ('Q002A072', 'date', ''),
                    ('Q002A073', 'option', 'gastric lavage'),
                    ('Q002A074', 'option', 'irrigated with'),
                    ('Q002A075', 'input', ''),
                    ('Q002A076', 'option', 'ml'),
                    ('Q002A077', 'input', ''),
                    ('Q002A078', 'option', 'pill fragments seen'),
                    ('Q002A079', 'option', 'return to clear'),
                    ('Q002A080', 'input', ''),
                    ('Q002A081', 'date', ''),
                    ('Q002A082', 'option', 'activated charcoal'),
                    ('Q002A083', 'option', 'w/ sorbital'),
                    ('Q002A084', 'option', 'PO'),
                    ('Q002A085', 'option', 'NG'),
                    ('Q002A086', 'option', 'dose:'),
                    ('Q002A087', 'input', ''),
                    ('Q002A088', 'date', ''),
                    ('Q002A089', 'option', 'assisted w/ central line placement'),
                    ('Q002A090', 'option', 'emergently placed'),
                    ('Q002A091', 'input', ''),
                    ('Q002A092', 'date', ''),
                    ('Q002A093', 'option', 'prep'),
                    ('Q002A094', 'option', 'hand hygiene'),
                    ('Q002A095', 'option', 'cap'),
                    ('Q002A096', 'option', 'mask'),
                    ('Q002A097', 'option', 'gown'),
                    ('Q002A098', 'option', 'gloves'),
                    ('Q002A099', 'input', ''),
                    ('Q002A100', 'date', ''),
                    ('Q002A101', 'option', 'full patient drape'),
                    ('Q002A102', 'option', 'Betadine prep'),
                    ('Q002A103', 'option', 'Chlorhexadine prep'),
                    ('Q002A104', 'input', ''),
                    ('Q002A105', 'date', ''),
                    ('Q002A106', 'option', 'assisted w/ chest tube insertion'),
                    ('Q002A107', 'option', 'fr.'),
                    ('Q002A108', 'input', ''),
                    ('Q002A109', 'option', 'site:'),
                    ('Q002A110', 'input', ''),
                    ('Q002A111', 'date', ''),
                    ('Q002A112', 'option', 'bronchodilator treatment'),
                    ('Q002A113', 'option', 'nebulizer'),
                    ('Q002A114', 'option', 'inhaler'),
                    ('Q002A115', 'input', ''),
                    ('Q002A116', 'date', ''),
                    ('Q002A117', 'option', '1x'),
                    ('Q002A118', 'input', ''),
                    ('Q002A119', 'date', ''),
                    ('Q002A120', 'option', '2x'),
                    ('Q002A121', 'input', ''),
                    ('Q002A122', 'date', ''),
                    ('Q002A123', 'option', '3x'),
                    ('Q002A124', 'input', ''),
                    ('Q002A125', 'date', ''),
                    ('Q002A126', 'option', 'warming measures'),
                    ('Q002A127', 'option', 'cooling measures'),
                    ('Q002A128', 'option', 'type:'),
                    ('Q002A129', 'input', ''),
                    ('Q002A130', 'date', ''),
                    ('Q002A131', 'option', 'assisted w/ peritoneal lavage'),
                    ('Q002A132', 'input', ''),
                    ('Q002A133', 'date', ''),
                    ('Q002A134', 'option', 'occlusive dressing applied'),
                    ('Q002A135', 'option', 'site:'),
                    ('Q002A136', 'input', ''),
                    ('Q002A137', 'date', ''),
                    ('Q002A138', 'option', 'pressure dressing applied'),
                    ('Q002A139', 'option', 'site:'),
                    ('Q002A140', 'input', ''),
                    ('Q002A141', 'date', ''),
                    ('Q002A142', 'option', 'rapid infusion system'),
                    ('Q002A143', 'input', ''),
                    ('Q002A144', 'date', ''),
                    ('Q002A145', 'option', 'NG'),
                    ('Q002A146', 'option', 'tube'),
                    ('Q002A147', 'option', 'fr.'),
                    ('Q002A148', 'input', ''),
                    ('Q002A149', 'option', 'mL return'),
                    ('Q002A150', 'input', ''),
                    ('Q002A151', 'date', ''),
                    ('Q002A152', 'option', 'placement confirmed'),
                    ('Q002A153', 'option', 'to suction'),
                    ('Q002A154', 'option', 'low'),
                    ('Q002A155', 'option', 'intermittent'),
                    ('Q002A156', 'input', ''),
                    ('Q002A157', 'date', ''),
                    ('Q002A158', 'option', 'restraints'),
                    ('Q002A159', 'option', 'see documentation'),
                    ('Q002A160', 'input', ''),
                    ('Q002A161', 'date', ''),
                    ('Q002A162', 'option', 'blood products administered'),
                    ('Q002A163', 'option', 'see transfusion record'),
                    ('Q002A164', 'input', ''),
                    ('Q002A165', 'date', ''),
                    ('Q002A166', 'option', 'ID band verified'),
                    ('Q002A167', 'option', 'consent signed'),
                    ('Q002A168', 'input', ''),
                    ('Q002A169', 'date', ''),
                    ('Q002A170', 'option', 'blood products matched by two staff members'),
                    ('Q002A172', 'input', ''),
                    ('Q002A173', 'date', ''),
                    ('Q002A174', 'option', 'to order'),
                    ('Q002A175', 'option', 'to blood products'),
                    ('Q002A176', 'input', ''),
                    ('Q002A177', 'date', ''),
                    ('Q002A178', 'option', 'estimated blood loss'),
                    ('Q002A179', 'input', ''),
                    ('Q002A180', 'option', 'mL'),
                    ('Q002A181', 'input', ''),
                    ('Q002A182', 'date', ''),
                    ('Q002A183', 'input', '')
            ) AS e(answer_code, type, label)
        LOOP
            IF NOT EXISTS (
                SELECT 1 FROM public."ChartsSourceOfTruth"
                WHERE "ChartCode" = chart_code 
                AND "AnswerCode" = elem.answer_code 
                AND "ChartSectionId" = 'SPRO'
                AND "ChartType" = 'Triage'
            ) THEN
                INSERT INTO public."ChartsSourceOfTruth" (
                    "Id", "ChartCode", "ChartSectionId", "ChartType", "AnswerCode", 
                    "Label", "Value", "Type", "CreatedAt", "CreatedBy", 
                    "UpdatedAt", "UpdatedBy", "Deleted", "DeletedAt", "DeletedBy"
                ) VALUES (
                    gen_random_uuid(),
                    chart_code,
                    'SPRO',
                    'Triage',
                    elem.answer_code,
                    elem.label,
                    NULL,
                    elem.type,
                    NOW(), NULL,
                    NOW(), NULL,
                    false, NULL, NULL
                );
            END IF;
        END LOOP;
    END LOOP;
END $$;